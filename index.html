<!DOCTYPE html>
<html lang="en">
<head>
<script
  type="text/javascript"
  src="https://pl28301262.effectivegatecpm.com/e7/48/38/e748384521ad7f55ac2d1360eb6fdb06.js"
></script>
   <script
  type="text/javascript"
  src="https://pl27535509.effectivegatecpm.com/e9/c6/b5/e9c6b581542b2d0e18a96a7e9c0e9105.js"
></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Merry Christmas Wishes</title>
    <style>
        /* --- CORE CSS --- */
        body {
            margin: 0;
            padding-top: 60px;
            background: radial-gradient(circle, #002e00, #000000); /* Dark Green/Black for Christmas */
            font-family: 'Arial', sans-serif;
            color: #fff;
            text-align: center;
            height: 100vh;
            overflow: auto;
            position: relative;
        }

        /* --- LAYERS --- */
        /* Canvas for Particles */
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 900;
            pointer-events: none;
        }

        /* CSS Animation Layer */
        #cssEffectLayer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 800;
            pointer-events: none;
        }

        /* Background Falling Icons */
        .flower {
            position: absolute;
            top: -10%;
            color: #fff;
            font-size: 20px;
            animation: fall linear forwards;
            z-index: 1;
            opacity: 0.9;
        }

        @keyframes fall {
            to { transform: translateY(110vh) rotate(360deg); }
        }

        /* --- ADS --- */
        .ad-container {
            position: fixed;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
        }
        .ad-top { top: 0; }

        /* --- PAGE MANAGEMENT --- */
        .page {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding-top: 60px;
            padding-bottom: 20px;
            box-sizing: border-box;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2000;
        }

        .page.active { display: flex; }

        /* --- PAGE 1 STYLE --- */
        #page1 .image-section {
            height: 55%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #page1 .main-media {
            width: 65%;
            height: 90%; 
            object-fit: contain;
            border: 3px solid #ff0000;
            border-radius: 15px;
            box-shadow: 0 0 20px #00ff00;
            background: black;
            z-index: 20;
        }

        #page1 .quote-section {
            height: 45%;
            width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 10px;
        }

        .gorgeous-box {
            background: rgba(100, 0, 0, 0.6);
            border: 2px double #00ff00;
            border-radius: 20px;
            padding: 15px;
            width: 100%;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
            animation: glow 2s infinite alternate;
        }

        .wish-text {
            font-size: 1.8rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px #000;
            margin-bottom: 5px;
        }

        .quote-text {
            font-size: 1rem;
            color: #ffeb3b;
            font-style: italic;
            margin-bottom: 10px;
            padding: 0 10px;
        }

        .create-msg {
            font-size: 0.9rem;
            color: #00ff00;
            margin-top: 10px;
            margin-bottom: 5px;
            animation: pulseText 1s infinite;
        }

        /* --- CREATION PAGES CONTAINER --- */
        .container-box {
            width: 90%;
            max-width: 450px;
            background: rgba(50, 0, 0, 0.9);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #00ff00;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            max-height: 85vh;
        }

        .input-field {
            padding: 12px;
            width: 80%;
            border-radius: 25px;
            border: 2px solid #ff0000;
            text-align: center;
            font-size: 16px;
            margin: 10px 0;
            outline: none;
            color: #000;
        }

        /* --- GRIDS & LISTS --- */
        .scroll-grid {
            width: 95%;
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 5px;
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
        }

        .effects-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .quotes-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Card Styles */
        .card-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .card-item.selected {
            background: rgba(0, 255, 0, 0.3);
            border: 2px solid gold;
            transform: scale(1.02);
        }

        .quote-card {
            font-size: 13px;
            font-style: italic;
            color: #ddd;
            text-align: left;
            display: block;
        }

        .effect-icon { font-size: 24px; margin-bottom: 5px; }
        .effect-name { font-size: 12px; font-weight: bold; }

        /* --- BUTTONS --- */
        .btn-row {
            display: flex;
            gap: 10px;
            width: 100%;
            justify-content: center;
            margin-top: 10px;
        }

        .btn-next, .wa-btn {
            background: linear-gradient(to right, #ff0000, #cc0000);
            color: white;
            border: 2px solid white;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            flex: 1;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        .btn-back {
            background: #444;
            color: white;
            border: 2px solid #999;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            width: auto;
        }

        .wa-btn {
            background: #25D366;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            animation: pulseBtn 2s infinite;
        }

        .btn-change-img {
            background: #25D366;
            color: white;
            border: 1px solid white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
            font-size: 14px;
        }
        .btn-change-img:active { transform: scale(0.95); }

        /* --- CSS EFFECTS --- */
        .fx-rays { background: repeating-conic-gradient(#000 0 15deg, rgba(255,215,0,0.2) 15deg 30deg); animation: spin 20s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .fx-glow { box-shadow: inset 0 0 50px gold; animation: pulseGlow 2s infinite; }
        @keyframes pulseGlow { 50% { box-shadow: inset 0 0 100px red; } }
        .fx-border { border: 10px solid transparent; border-image: linear-gradient(45deg, red, gold, green) 1; animation: borderRotate 2s infinite; }
        .fx-orbs { background-image: radial-gradient(circle, rgba(255,255,255,0.2) 2px, transparent 2.5px); background-size: 30px 30px; animation: moveBg 10s linear infinite; }
        @keyframes moveBg { from {background-position: 0 0;} to {background-position: 100% 100%;} }
        .fx-spotlight { background: radial-gradient(circle at 50% 50%, transparent 10%, rgba(0,0,0,0.8) 80%); animation: spotMove 5s infinite alternate; }
        @keyframes spotMove { 0% {background-position: 0% 50%;} 100% {background-position: 100% 50%;} }

        @keyframes glow { from {box-shadow: 0 0 10px #ff0000;} to {box-shadow: 0 0 25px #00ff00;} }
        @keyframes pulseText { 0% {opacity: 0.6;} 50% {opacity: 1;} 100% {opacity: 0.6;} }
        @keyframes pulseBtn { 0% {transform: scale(1);} 50% {transform: scale(1.02);} 100% {transform: scale(1);} }

        #manualShare { display: none; margin-top: 10px; width: 100%; text-align: center;}
        #generatedUrl { width: 90%; background: #222; color: #fff; border: 1px solid #555; font-size: 10px; padding: 5px; }
    </style>
</head>
<body>

    <!-- 1. VISUAL LAYERS -->
    <div id="cssEffectLayer"></div>
    <canvas id="fireworksCanvas"></canvas>

    <!-- 2. TOP AD (Adsterra) -->
    <div class="ad-container ad-top">
        <script type="text/javascript">
            atOptions = { 'key' : '5151d99dda1d9483bde7073716b4e6c7', 'format' : 'iframe', 'height' : 60, 'width' : 468, 'params' : {} };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/5151d99dda1d9483bde7073716b4e6c7/invoke.js"></script>
    </div>

    <!-- ================= PAGE 1: GREETING VIEW ================= -->
    <div id="page1" class="page">
        <div class="image-section">
            <video src="images/vil.mp4" class="main-media" id="displayImage" autoplay loop muted playsinline webkit-playsinline></video>
        </div>

        <div class="quote-section">
            <div class="gorgeous-box">
                <div class="wish-text">
                    Merry Christmas<br>
                    <span style="font-size: 1.2rem; color: #ccc;">From</span><br>
                    <span id="senderNameDisplay" style="color: gold; font-size: 2rem;">You</span>
                </div>
                
                <p class="quote-text" id="mainQuoteText">
                    "May this Christmas bring you joy, Happiness and love. Wishing you and your family A very Merry Christmas!"
                </p>

                <p class="create-msg">üëá ‚ÄúClick below to write your name.‚Äù üëá</p>
                <button class="btn-next" onclick="goToPage(2)">Next ‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <!-- ================= PAGE 2: NAME & VIDEO ================= -->
    <div id="page2" class="page">
        <div class="container-box">
            <h2 style="color: gold; margin: 10px 0;">Step 1: Details üéÑ</h2>
            
            <video src="images/vil.mp4" id="previewImage" autoplay loop muted playsinline webkit-playsinline style="width: 150px; height: 150px; object-fit: contain; border-radius: 10px; border: 2px solid white; background: black;"></video>

            <button class="btn-change-img" onclick="changeImage()">Change Video üîÑ</button>

            <p style="color: white; margin-bottom: 5px; margin-top: 5px;">Enter Your Name:</p>
            <input type="text" id="nameInput" class="input-field" placeholder="Enter Your Name">
            
            <div class="btn-row">
                <button class="btn-back" onclick="goToPage(1)">‚¨ÖÔ∏è Back</button>
                <button class="btn-next" onclick="goToPage(3)">Next ‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <!-- ================= PAGE 3: EFFECT SELECTION ================= -->
    <div id="page3" class="page">
        <div class="container-box">
            <h2 style="color: gold; margin: 10px 0;">Step 2: Magic ‚ú®</h2>
            <p style="font-size: 12px; margin-bottom: 5px;">Select an animation:</p>
            
            <div class="scroll-grid">
                <div class="effects-grid" id="effectsGrid">
                    <!-- JS will fill this -->
                </div>
            </div>

            <div class="btn-row">
                <button class="btn-back" onclick="goToPage(2)">‚¨ÖÔ∏è Back</button>
                <button class="btn-next" onclick="goToPage(4)">Next ‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <!-- ================= PAGE 4: QUOTE SELECTION & SHARE ================= -->
    <div id="page4" class="page">
        <div class="container-box">
            <h2 style="color: gold; margin: 10px 0;">Step 3: Quote üìù</h2>
            <p style="font-size: 12px; margin-bottom: 5px;">Select a wish & Share:</p>
            
            <div class="scroll-grid">
                <div class="quotes-list" id="quotesList">
                    <!-- JS will fill this -->
                </div>
            </div>

            <button class="wa-btn" onclick="shareOnWhatsApp()">
                <svg width="24" height="24" viewBox="0 0 448 512" style="fill:white;"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.9 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
                Share on WhatsApp
            </button>

            <div class="btn-row">
                <button class="btn-back" onclick="goToPage(3)">‚¨ÖÔ∏è Back</button>
            </div>

            <div id="manualShare">
                <input type="text" id="generatedUrl" readonly>
                <button onclick="copyLink()" style="margin-top:5px; cursor: pointer;">Copy Link</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- 1. DATASETS ---
        const images = [
            'images/vil.mp4', 'images/vil1.mp4', 'images/vil2.mp4', 'images/vil3.mp4', 
            'images/vil4.mp4', 'images/vil5.mp4', 'images/vil6.mp4', 'images/vil7.mp4', 
            'images/vil8.mp4', 'images/vil9.mp4', 'images/vil10.mp4', 'images/vil11.mp4', 
            'images/vil12.mp4', 'images/vil13.mp4', 'images/vil14.mp4', 'images/vil15.mp4', 
            'images/vil16.mp4', 'images/vil17.mp4', 'images/vil18.mp4'
        ];

        const effectsData = [
            { id: 1, name: "Golden Spark Rain", type: "particle", icon: "‚ú®" },
            { id: 2, name: "Luxury Light Rays", type: "css", icon: "üåü", cssClass: "fx-rays" },
            { id: 3, name: "Glowing Particle Field", type: "particle", icon: "üí´" },
            { id: 4, name: "3D Floating Orbs", type: "css", icon: "üîÆ", cssClass: "fx-orbs" },
            { id: 5, name: "Premium Confetti Burst", type: "particle", icon: "üéâ" },
            { id: 6, name: "Shimmer Border", type: "css", icon: "üñºÔ∏è", cssClass: "fx-border" },
            { id: 7, name: "Diamond Dust Effect", type: "particle", icon: "üíé" },
            { id: 8, name: "Soft Bokeh Lights", type: "particle", icon: "üîÜ" },
            { id: 9, name: "Aura Glow Effect", type: "css", icon: "üåà", cssClass: "fx-glow" },
            { id: 10, name: "Neon Line Flow", type: "particle", icon: "‚ö°" },
            { id: 11, name: "Luxury Smoke", type: "particle", icon: "‚òÅÔ∏è" },
            { id: 12, name: "Royal Crown Sparkle", type: "particle", icon: "üëë" },
            { id: 13, name: "Star Trail Animation", type: "particle", icon: "‚≠ê" },
            { id: 14, name: "Golden Frame Shine", type: "css", icon: "üü®", cssClass: "fx-rays" },
            { id: 15, name: "Magical Wave Effect", type: "particle", icon: "üåä" },
            { id: 16, name: "Glass Reflection", type: "css", icon: "ü™û", cssClass: "fx-rays" },
            { id: 17, name: "Spotlight Move", type: "css", icon: "üé•", cssClass: "fx-spotlight" },
            { id: 18, name: "Particle Text", type: "particle", icon: "üìù" },
            { id: 19, name: "Luxury Fade", type: "css", icon: "üéûÔ∏è", cssClass: "fx-glow" },
            { id: 20, name: "Festival Grand Entry", type: "particle", icon: "üî•" }
        ];

        const quotesData = [
            { id: 1, text: "May the magic of Christmas fill your heart with peace, your home with joy, and your life with endless blessings." },
            { id: 2, text: "Christmas is not a season, it‚Äôs a feeling of love, warmth, and togetherness that lasts forever." },
            { id: 3, text: "Let the Christmas lights brighten your soul and the holiday spirit guide your dreams." },
            { id: 4, text: "This Christmas, may your worries fade away and your happiness shine brighter than the stars." },
            { id: 5, text: "The true gift of Christmas is not wrapped in paper, but in love, kindness, and compassion." },
            { id: 6, text: "May your Christmas be as warm as a hug, as sweet as a smile, and as joyful as laughter." },
            { id: 7, text: "Christmas teaches us that the smallest acts of kindness can create the biggest miracles." },
            { id: 8, text: "Let your heart be light, your faith be strong, and your Christmas be truly magical." },
            { id: 9, text: "May the spirit of Christmas bring hope to your heart and happiness to your days." },
            { id: 10, text: "Christmas is a reminder that love grows best when shared with those who matter most." },
            { id: 11, text: "Wrap your heart in gratitude and your soul in joy this beautiful Christmas season." },
            { id: 12, text: "May every snowflake carry a wish and every bell ring bring you peace this Christmas." },
            { id: 13, text: "Christmas is the time when ordinary moments turn into priceless memories." },
            { id: 14, text: "Let the warmth of Christmas melt away the coldest worries of your heart." },
            { id: 15, text: "This Christmas, choose love over fear, kindness over judgment, and joy over stress." },
            { id: 16, text: "May your Christmas sparkle with moments of love, laughter, and endless cheer." },
            { id: 17, text: "The beauty of Christmas lies in giving without expecting and loving without limits." },
            { id: 18, text: "May the Christmas spirit remind you how special, loved, and blessed you truly are." },
            { id: 19, text: "Christmas turns simple days into celebrations and ordinary hearts into joyful ones." },
            { id: 20, text: "As Christmas arrives, may your life be filled with light, peace, and beautiful new beginnings." }
        ];
        
        // --- 2. STATE ---
        let currentIndex = 0; 
        let currentEffectId = 0; 
        let currentQuoteId = 1; 

        // --- 3. INIT ---
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const senderName = urlParams.get('n');
            const imgIndex = urlParams.get('i'); 
            const effIndex = urlParams.get('e');
            const qIndex = urlParams.get('q');

            // Restore State
            if (imgIndex !== null) currentIndex = parseInt(imgIndex) % images.length;
            if (effIndex !== null) currentEffectId = parseInt(effIndex);
            if (qIndex !== null) currentQuoteId = parseInt(qIndex);

            // Update Media
            document.getElementById('displayImage').src = images[currentIndex];
            document.getElementById('previewImage').src = images[currentIndex];

            // Update Text
            if (senderName) {
                document.getElementById('senderNameDisplay').innerText = decodeURIComponent(senderName);
                document.getElementById('page1').classList.add('active'); 
            } else {
                document.getElementById('senderNameDisplay').innerText = "Friends & Family";
                document.getElementById('page1').classList.add('active');
            }

            // Update Quote
            const qObj = quotesData.find(q => q.id === currentQuoteId);
            if(qObj) document.getElementById('mainQuoteText').innerText = `"${qObj.text}"`;

            // Render Grids
            renderEffectButtons();
            renderQuoteButtons();

            // Apply Effect
            applyEffectLogic(currentEffectId);
            
            // BG Icons
            createChristmasIcons();
        };

        // --- 4. NAVIGATION ---
        function goToPage(pageNum) {
            // AD TRIGGER: Whenever navigating
            try { Android.showAd(); } catch(e) {} 

            // Validation
            if(pageNum === 3) {
                const name = document.getElementById('nameInput').value.trim();
                if (name === "") { alert("Please enter your name first!"); return; }
            }

            // Switch
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page' + pageNum).classList.add('active');

            // Video
            if(pageNum === 2) document.getElementById('previewImage').play().catch(e=>{});
        }

        function changeImage() {
            currentIndex = (currentIndex + 1) % images.length;
            document.getElementById('previewImage').src = images[currentIndex];
            document.getElementById('previewImage').play(); 
            document.getElementById('displayImage').src = images[currentIndex];
        }

        // --- 5. RENDERERS ---
        function renderEffectButtons() {
            const grid = document.getElementById('effectsGrid');
            grid.innerHTML = '';
            effectsData.forEach(fx => {
                const card = document.createElement('div');
                card.className = 'card-item';
                card.innerHTML = `<div class="effect-icon">${fx.icon}</div><div class="effect-name">${fx.name}</div>`;
                card.onclick = () => selectEffect(fx.id);
                if (fx.id === currentEffectId) card.classList.add('selected');
                grid.appendChild(card);
            });
        }

        function renderQuoteButtons() {
            const list = document.getElementById('quotesList');
            list.innerHTML = '';
            quotesData.forEach(q => {
                const card = document.createElement('div');
                card.className = 'card-item quote-card';
                card.innerHTML = `"${q.text}"`;
                card.onclick = () => selectQuote(q.id);
                if (q.id === currentQuoteId) card.classList.add('selected');
                list.appendChild(card);
            });
        }

        // --- 6. SELECTIONS ---
        function selectEffect(id) {
            currentEffectId = id;
            document.querySelectorAll('#effectsGrid .card-item').forEach(c => c.classList.remove('selected'));
            renderEffectButtons(); 
            applyEffectLogic(id);
        }

        function selectQuote(id) {
            currentQuoteId = id;
            document.querySelectorAll('#quotesList .card-item').forEach(c => c.classList.remove('selected'));
            renderQuoteButtons(); 
            
            // Update Page 1 preview for sender to see
            const qObj = quotesData.find(q => q.id === id);
            if(qObj) document.getElementById('mainQuoteText').innerText = `"${qObj.text}"`;
        }

        function applyEffectLogic(id) {
            const cssLayer = document.getElementById('cssEffectLayer');
            cssLayer.className = ''; cssLayer.innerHTML = ''; 
            
            if (id === 0) { startCanvasAnimation('fireworks'); return; }

            const effect = effectsData.find(e => e.id === id);
            if (!effect) { startCanvasAnimation('fireworks'); return; }

            if (effect.type === 'css') {
                startCanvasAnimation('none'); 
                cssLayer.className = effect.cssClass;
            } else {
                startCanvasAnimation(effect.id);
            }
        }

        // --- 7. CANVAS ENGINE ---
        let animationFrameId;
        function startCanvasAnimation(type) {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            const canvas = document.getElementById("fireworksCanvas");
            const ctx = canvas.getContext("2d");
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            let particles = [];

            function Particle(x, y, color, speed, size, behavior) {
                this.x = x; this.y = y; this.color = color;
                this.size = size;
                this.vx = (Math.random() - 0.5) * speed;
                this.vy = (Math.random() - 0.5) * speed;
                this.alpha = 1; this.behavior = behavior;
            }
            Particle.prototype.update = function() {
                if(this.behavior === 'gravity') this.vy += 0.1;
                if(this.behavior === 'float') { this.vy -= 0.05; this.x += Math.sin(this.y/10)*0.5; }
                if(this.behavior === 'rain') { this.vy = 5; }
                this.x += this.vx; this.y += this.vy; this.alpha -= 0.01;
            }
            Particle.prototype.draw = function() {
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
                ctx.fill();
            }

            function loop() {
                animationFrameId = requestAnimationFrame(loop);
                ctx.globalCompositeOperation = 'destination-out';
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.globalCompositeOperation = 'source-over';

                if (type === 'fireworks' || type === 20) {
                    if (Math.random() < 0.1) for(let i=0; i<30; i++) particles.push(new Particle(Math.random()*canvas.width, Math.random()*canvas.height/2, `hsl(${Math.random()*360}, 100%, 50%)`, 8, 2, 'gravity'));
                }
                else if (type === 1) { if (Math.random() < 0.3) particles.push(new Particle(Math.random()*canvas.width, 0, 'gold', 1, 3, 'rain')); }
                else if (type === 5) { if (Math.random() < 0.2) particles.push(new Particle(Math.random()*canvas.width, 0, ['red','green','blue','gold'][Math.floor(Math.random()*4)], 5, 4, 'gravity')); }
                else if (type === 7) { if (Math.random() < 0.5) particles.push(new Particle(Math.random()*canvas.width, Math.random()*canvas.height, '#b9f2ff', 1, 1, 'float')); }
                else if (type === 11) { if (Math.random() < 0.1) particles.push(new Particle(canvas.width/2, canvas.height, 'rgba(200,200,200,0.5)', 2, 10, 'float')); }
                else { if (Math.random() < 0.1) particles.push(new Particle(Math.random()*canvas.width, Math.random()*canvas.height, 'white', 2, 2, 'float')); }

                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].update();
                    particles[i].draw();
                    if (particles[i].alpha <= 0 || particles[i].y > canvas.height) particles.splice(i, 1);
                }
            }
            if (type !== 'none') loop();
            else ctx.clearRect(0,0,canvas.width,canvas.height);
        }

        // --- 8. SHARE LOGIC ---
        function shareOnWhatsApp() {
            // AD TRIGGER
            try { Android.showAd(); } catch(e) {}

            const name = document.getElementById('nameInput').value.trim();
            const baseUrl = window.location.href.split('?')[0];
            const newUrl = baseUrl + "?n=" + encodeURIComponent(name) + "&i=" + currentIndex + "&e=" + currentEffectId + "&q=" + currentQuoteId;

            document.getElementById('manualShare').style.display = 'block';
            document.getElementById('generatedUrl').value = newUrl;

            const msg = `üéÑ *Merry Christmas Surprise* üéÑ\n\n${name} has sent you a magical greeting! üéÖ\nSee the magic here üëá\n\n${newUrl}`;
            window.location.href = "whatsapp://send?text=" + encodeURIComponent(msg);
        }

        function copyLink() {
            const copyText = document.getElementById("generatedUrl");
            copyText.select();
            document.execCommand("copy");
            alert("Link Copied!");
        }

        function createChristmasIcons() {
            const symbols = ['‚ùÑÔ∏è', 'üéÑ', 'üéÖ', 'üéÅ', '‚õÑ'];
            setInterval(() => {
                const el = document.createElement('div');
                el.classList.add('flower');
                el.innerText = symbols[Math.floor(Math.random() * symbols.length)];
                el.style.left = Math.random() * 100 + 'vw';
                el.style.animationDuration = Math.random() * 3 + 2 + 's';
                document.body.appendChild(el);
                setTimeout(() => { el.remove(); }, 5000);
            }, 500);
        }
    </script>
</body>
</html>
